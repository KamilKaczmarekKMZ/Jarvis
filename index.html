<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Webhook Chat z Obsługą Głosu</title>
    <style>
        /* Reset i tło */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #000;
            color: #d6d6e6;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Kontener czatu */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 90vh;
            width: 95%;
            max-width: 800px;
            background-color: rgba(15, 15, 16, 0.9);
            border-radius: 15px;
            border: 1px solid #3d3a4f;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.9);
            position: relative;
        }

        /* Spinner WEWNĄTRZ kontenera czatu */
        .chat-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            opacity: 0.8;
            filter: drop-shadow(0 0 25px rgba(186, 66, 255, 0.7));
        }
        
        .spinner {
            background-image: linear-gradient(rgb(186, 66, 255) 35%, rgb(0, 225, 255));
            width: 100px;
            height: 100px;
            animation: spinning 1.7s linear infinite;
            border-radius: 50px;
            filter: blur(1px);
            box-shadow: 
                0px -5px 25px 0px rgba(186, 66, 255, 0.9),
                0px 5px 25px 0px rgba(0, 225, 255, 0.9);
        }
        
        .spinner-inner {
            background-color: rgba(36, 36, 36, 0.3);
            width: 100px;
            height: 100px;
            border-radius: 50px;
            filter: blur(8px);
        }

        @keyframes spinning {
            to { transform: rotate(360deg); }
        }

        /* Okno wiadomości */
        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            position: relative;
            z-index: 2;
            scrollbar-width: thin;
            scrollbar-color: #402fb5 #161329;
        }
        
        #messages::-webkit-scrollbar {
            width: 8px;
        }
        
        #messages::-webkit-scrollbar-track {
            background: #161329;
        }
        
        #messages::-webkit-scrollbar-thumb {
            background-color: #402fb5;
            border-radius: 4px;
        }

        .message {
            padding: 14px 18px;
            margin-bottom: 16px;
            border-radius: 10px;
            max-width: 85%;
            position: relative;
            word-wrap: break-word;
            animation: fadeIn 0.4s ease-out;
            line-height: 1.4;
            font-size: 16px;
            backdrop-filter: blur(5px);
        }
        
        .user-message {
            background: rgba(64, 47, 181, 0.35);
            border: 1px solid #4a3bc0;
            margin-left: auto;
            box-shadow: 0 2px 12px rgba(64, 47, 181, 0.2);
        }
        
        .bot-message {
            background: rgba(28, 25, 28, 0.9);
            border: 1px solid #4a475f;
            margin-right: auto;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
        }

        /* Pole wprowadzania (ulepszone) */
        #poda {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-color: rgba(1, 2, 1, 0.6);
            position: relative;
            z-index: 2;
        }

        .input-container {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 500px;
        }

        .voice-btn {
            background: rgba(207, 48, 170, 0.3);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .voice-btn:hover {
            background: rgba(207, 48, 170, 0.5);
            transform: scale(1.1);
        }

        .voice-btn.recording {
            animation: pulse 1.5s infinite;
            background: rgba(255, 0, 0, 0.5);
        }

        .voice-icon {
            width: 20px;
            height: 20px;
        }

        .white, .border, .darkBorderBg, .glow {
            max-height: 70px;
            max-width: 314px;
            height: 100%;
            width: 100%;
            position: absolute;
            overflow: hidden;
            z-index: -1;
            border-radius: 12px;
            filter: blur(3px);
        }

        .input {
            flex: 1;
            background-color: #010201;
            border: none;
            height: 56px;
            border-radius: 10px;
            color: white;
            padding-inline: 59px;
            font-size: 18px;
            caret-color: #cf30aa;
        }

        .input::placeholder {
            color: #5a5565;
            transition: all 0.3s;
        }

        .input:focus::placeholder {
            opacity: 0.5;
        }

        .input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(207, 48, 170, 0.4);
        }

        #main:focus-within > #input-mask {
            display: none;
        }

        #input-mask {
            pointer-events: none;
            width: 100px;
            height: 20px;
            position: absolute;
            background: linear-gradient(90deg, transparent, #010201);
            top: 18px;
            left: 70px;
            transition: all 0.5s;
        }

        #pink-mask {
            pointer-events: none;
            width: 30px;
            height: 20px;
            position: absolute;
            background: #cf30aa;
            top: 10px;
            left: 5px;
            filter: blur(20px);
            opacity: 0.8;
            transition: all 1s;
        }

        #main:hover > #pink-mask {
            opacity: 0;
            transform: translateX(10px);
        }

        /* Animacje */
        @keyframes spinning {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }

        /* Indykator nagrywania */
        .recording-indicator {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
            align-items: center;
            z-index: 100;
        }

        .recording-dot {
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            margin-right: 10px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <!-- Główny kontener czatu -->
    <div class="chat-container">
        <!-- Spinner WEWNĄTRZ kontenera czatu -->
        <div class="chat-spinner">
            <div class="spinner">
                <div class="spinner-inner"></div>
            </div>
        </div>
        
        <!-- Okno wiadomości -->
        <div id="messages">
            <div class="message bot-message">
                Witaj! Możesz pisać lub mówić - wiadomości będą wysyłane do webhooka.
            </div>
        </div>
        
        <!-- Pole wprowadzania -->
        <div id="poda">
            <div class="glow"></div>
            <div class="darkBorderBg"></div>
            <div class="darkBorderBg"></div>
            <div class="darkBorderBg"></div>
            <div class="white"></div>
            <div class="border"></div>
            
            <div id="main">
                <div class="input-container">
                    <button class="voice-btn" id="voiceButton" title="Naciśnij i przytrzymaj, aby nagrywać">
                        <svg class="voice-icon" viewBox="0 0 24 24" fill="none" stroke="#d6d6e6" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <input placeholder="Napisz wiadomość lub naciśnij ikonę mikrofonu..." 
                           type="text" 
                           id="messageInput" 
                           class="input" />
                    <div id="input-mask"></div>
                    <div id="pink-mask"></div>
                    <div class="filterBorder"></div>
                    <div id="filter-icon">
                        <svg preserveAspectRatio="none" height="27" width="27" viewBox="4.8 4.56 14.832 15.408" fill="none">
                            <path d="M8.16 6.65002H15.83C16.47 6.65002 16.99 7.17002 16.99 7.81002V9.09002C16.99 9.56002 16.7 10.14 16.41 10.43L13.91 12.64C13.56 12.93 13.33 13.51 13.33 13.98V16.48C13.33 16.83 13.1 17.29 13.81 17.47L12 17.98C11.24 18.45 10.2 17.92 10.2 16.99V13.91C10.2 13.5 9.97 12.98 9.73 12.69L7.52 10.36C7.23 10.08 7 9.55002 7 9.20002V7.87002C7 7.17002 7.52 6.65002 8.16 6.65002Z" stroke="#d6d6e6" stroke-width="1" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>
                    <div id="search-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" height="24" fill="none" class="feather feather-search">
                            <circle stroke="url(#search)" r="8" cy="11" cx="11"></circle>
                            <line stroke="url(#searchl)" y2="16.65" y1="22" x2="16.65" x1="22"></line>
                            <defs>
                                <linearGradient gradientTransform="rotate(50)" id="search">
                                    <stop stop-color="#f8e7f8" offset="0%"></stop>
                                    <stop stop-color="#b6a9b7" offset="50%"></stop>
                                </linearGradient>
                                <linearGradient id="searchl">
                                    <stop stop-color="#b6a9b7" offset="0%"></stop>
                                    <stop stop-color="#837484" offset="50%"></stop>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Indykator nagrywania -->
    <div class="recording-indicator" id="recordingIndicator">
        <div class="recording-dot"></div>
        Nagrywanie... Zwolnij przycisk, aby wysłać
    </div>

    <script>
        // Elementy DOM
        const messageInput = document.getElementById('messageInput');
        const messagesDiv = document.getElementById('messages');
        const filterIcon = document.getElementById('filter-icon');
        const chatSpinner = document.querySelector('.chat-spinner');
        const voiceButton = document.getElementById('voiceButton');
        const recordingIndicator = document.getElementById('recordingIndicator');
        
        // Inicjalizacja
        let recognition;
        let isRecording = false;
        
        // Sprawdź czy przeglądarka obsługuje Web Speech API
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'pl-PL';
            
            recognition.onstart = function() {
                isRecording = true;
                voiceButton.classList.add('recording');
                recordingIndicator.style.display = 'flex';
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                if (transcript.trim()) {
                    addMessage(transcript, true);
                    sendToWebhook(transcript);
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Błąd rozpoznawania mowy:', event.error);
                addMessage("Błąd rozpoznawania mowy", false);
            };
            
            recognition.onend = function() {
                isRecording = false;
                voiceButton.classList.remove('recording');
                recordingIndicator.style.display = 'none';
            };
        } else {
            voiceButton.style.display = 'none';
            addMessage("Twoja przeglądarka nie obsługuje rozpoznawania mowy", false);
        }
        
        // Obsługa przycisku głosowego
        voiceButton.addEventListener('mousedown', startRecording);
        voiceButton.addEventListener('touchstart', startRecording);
        
        voiceButton.addEventListener('mouseup', stopRecording);
        voiceButton.addEventListener('touchend', stopRecording);
        voiceButton.addEventListener('mouseleave', stopRecording);
        
        function startRecording(e) {
            e.preventDefault();
            if (recognition && !isRecording) {
                recognition.start();
            }
        }
        
        function stopRecording(e) {
            e.preventDefault();
            if (recognition && isRecording) {
                recognition.stop();
            }
        }
        
        // Ukryj spinner gdy są wiadomości
        function updateSpinnerVisibility() {
            if (messagesDiv.children.length > 1) {
                chatSpinner.style.opacity = '0';
                setTimeout(() => {
                    chatSpinner.style.display = 'none';
                }, 300);
            } else {
                chatSpinner.style.display = 'block';
                setTimeout(() => {
                    chatSpinner.style.opacity = '0.8';
                }, 10);
            }
        }
        
        // Wysyłanie wiadomości po Enter
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const message = messageInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    messageInput.value = '';
                    sendToWebhook(message);
                    updateSpinnerVisibility();
                }
            }
        });
        
        // Opcjonalne: kliknięcie ikony filtra
        filterIcon.addEventListener('click', function() {
            addMessage("Funkcja filtrowania będzie dostępna wkrótce!", false);
        });
        
        function addMessage(text, isUser) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(isUser ? 'user-message' : 'bot-message');
            
            // Dodaj ikonę dla wiadomości głosowych
            if (isUser && text.startsWith("(Głos) ")) {
                messageElement.innerHTML = `
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    </svg>
                    ${text.substring(7)}
                `;
            } else {
                messageElement.textContent = text;
            }
            
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function sendToWebhook(message) {
            // Tutaj podmień na swój webhook
            const webhookUrl = 'TWÓJ_WEBHOOK_URL';
            
            // Pokazuj spinner podczas oczekiwania na odpowiedź
            chatSpinner.style.display = 'block';
            chatSpinner.style.opacity = '0.8';
            
            fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: message,
                    timestamp: new Date().toISOString(),
                    type: isRecording ? 'voice' : 'text'
                })
            })
            .then(response => response.json())
            .then(data => {
                addMessage(data.response || "Otrzymałem twoją wiadomość", false);
                updateSpinnerVisibility();
            })
            .catch(error => {
                addMessage("Błąd połączenia z webhookiem", false);
                console.error('Error:', error);
                updateSpinnerVisibility();
            });
        }
        
        // Inicjalizacja
        updateSpinnerVisibility();
    </script>
</body>
</html>
